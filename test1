<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Episode 1. 비밀이지</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .main-wrapper {
            display: flex;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
        }
        
        .game-container {
            background: #000;
            border: 3px solid #fff;
            flex: 1;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8);
        }
        
        .side-panel {
            background: #000;
            border: 3px solid #fff;
            width: 300px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8);
        }
        
        .title {
            background: #000;
            color: #fff;
            text-align: center;
            padding: 15px;
            font-size: 18px;
            border-bottom: 3px solid #fff;
        }
        
        .screen {
            background: #000;
            border: 3px solid #fff;
            margin: 20px;
            padding: 40px 30px;
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .intro-text {
            color: #fff;
            text-align: center;
            line-height: 1.8;
            font-size: 15px;
        }
        
        .intro-text p {
            margin-bottom: 15px;
        }
        
        .notice {
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .input-section {
            background: #fff;
            padding: 15px;
            margin: 0 20px 20px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .label {
            font-weight: bold;
            color: #000;
            white-space: nowrap;
        }
        
        .input-box {
            flex: 1;
            padding: 10px;
            border: 2px solid #4a9eff;
            font-size: 14px;
            background: #e6f3ff;
        }
        
        .input-box:focus {
            outline: none;
            border-color: #2196F3;
            background: #fff;
        }
        
        .hint {
            color: #666;
            text-align: center;
            padding: 0 20px 20px 20px;
            font-size: 13px;
        }
        
        .footer {
            text-align: center;
            padding: 15px;
            color: #ff0000;
            font-size: 14px;
            border-top: 1px solid #333;
        }
        
        .copyright {
            color: #ffeb3b;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .success-message, .error-message {
            display: none;
            padding: 10px;
            margin: 0 20px 10px 20px;
            border: 2px solid;
            text-align: center;
            animation: fadeIn 0.5s;
        }
        
        .success-message {
            color: #4CAF50;
            background: #e8f5e9;
            border-color: #4CAF50;
        }
        
        .error-message {
            color: #f44336;
            background: #ffebee;
            border-color: #f44336;
        }
        
        .panel-title {
            background: #000;
            color: #fff;
            text-align: center;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            border-bottom: 3px solid #fff;
        }
        
        .panel-content {
            padding: 20px;
            color: #fff;
        }
        
        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .inventory-table th {
            background: #333;
            color: #fff;
            padding: 8px;
            font-size: 12px;
            border: 1px solid #666;
        }
        
        .inventory-table td {
            padding: 8px;
            border: 1px solid #666;
            font-size: 12px;
        }
        
        .inventory-input {
            width: 100%;
            padding: 5px;
            background: #e6f3ff;
            border: 1px solid #4a9eff;
            font-size: 11px;
        }
        
        .inventory-hint {
            margin-top: 15px;
            font-size: 11px;
            color: #aaa;
            line-height: 1.6;
        }
        
        .branch-input {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            background: #e6f3ff;
            border: 2px solid #4a9eff;
            font-size: 12px;
        }
        
        .branch-desc {
            margin-top: 10px;
            padding: 10px;
            background: #1a1a1a;
            border: 1px solid #333;
            font-size: 11px;
            color: #ccc;
            min-height: 60px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 1024px) {
            .main-wrapper {
                flex-direction: column;
            }
            .side-panel {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <div class="game-container">
            <div class="title">Episode 1. 비밀이지</div>
            
            <div class="screen">
                <div class="intro-text">
                    <p><strong>게임을 시작하려면 아래 키워드에<br>"놀짱밴"을 입력하세요.</strong></p>
                    <p class="notice">※ "Episode 1. 비밀이지" 은<br>Act 1로 구성된 단편 방탈출입니다.<br>반드시 Act 순서대로 진행하시기 바랍니다.</p>
                    <p class="notice">※ 로 시작하는 지문은 게임 진행에 있어<br>정말 중요한 공지사항입니다.<br>반드시 꼼꼼하게 읽어주세요.</p>
                </div>
            </div>
            
            <div class="success-message" id="successMsg"></div>
            <div class="error-message" id="errorMsg"></div>
            
            <div class="input-section">
                <span class="label">키워드</span>
                <input type="text" class="input-box" id="keywordInput" placeholder="">
            </div>
            
            <div class="hint">하늘색 칸에 키워드 코드를 기입하세요. 다른 칸은 건들지 마세요.</div>
            
            <div class="footer">
                <div>Act 1. 초대 링크</div>
                <div class="copyright">ⓒ 2023. Nandy All rights reserved.</div>
            </div>
        </div>
        
        <div class="side-panel">
            <div class="panel-title">인벤토리</div>
            <div class="panel-content">
                <table class="inventory-table">
                    <thead>
                        <tr>
                            <th>아이템 코드</th>
                            <th>이름</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" class="inventory-input" id="item1"></td>
                            <td id="itemName1">-</td>
                        </tr>
                        <tr>
                            <td><input type="text" class="inventory-input" id="item2"></td>
                            <td id="itemName2">-</td>
                        </tr>
                        <tr>
                            <td><input type="text" class="inventory-input" id="item3"></td>
                            <td id="itemName3">-</td>
                        </tr>
                        <tr>
                            <td><input type="text" class="inventory-input" id="item4"></td>
                            <td id="itemName4">-</td>
                        </tr>
                        <tr>
                            <td><input type="text" class="inventory-input" id="item5"></td>
                            <td id="itemName5">-</td>
                        </tr>
                    </tbody>
                </table>
                <div class="inventory-hint">
                    인벤토리 사용법: 하늘색 칸에 아이템 코드를 기입하세요. 다른 칸은 건들지 마세요.
                </div>
                
                <div style="margin-top: 20px;">
                    <div style="font-size: 13px; font-weight: bold; margin-bottom: 10px; color: #4a9eff;">상세 설명 (아이템 코드 입력)</div>
                    <input type="text" class="inventory-input" id="itemDetailCode" placeholder="아이템 코드 입력" style="margin-bottom: 10px;">
                    <div id="itemDetail" style="padding: 10px; background: #1a1a1a; border: 1px solid #333; min-height: 80px; font-size: 12px; line-height: 1.6; color: #ccc;">
                        아이템 코드를 입력하면 상세 설명이 표시됩니다.
                    </div>
                </div>
            </div>
            
            <div class="panel-title" style="margin-top: 20px; border-top: 3px solid #fff;">분기점</div>
            <div class="panel-content">
                <input type="text" class="branch-input" id="branchCode" placeholder="분기 코드">
                <div class="branch-desc" id="branchDesc">분기점 사용법: 하늘색 칸에 분기 코드를 기입하세요. 다른 칸은 건들지 마세요.</div>
            </div>
        </div>
    </div>
    
    <script>
        // 수정된 부분만 포함한 게임 데이터
        const gameData = {
            "놀짱밴": "비가 엄청나게 쏟아지던 날,\n한 통의 초대 링크가 찾아왔다.\n\n(신유 도훈 / 도훈 신유)\n\n※ ( ) 괄호 안에는 현재 플레이어가 입력할 수 있는\n키워드 코드가 나열되어 있습니다.\n키워드는 \"도훈 신유\" 처럼 공개되어 있기도 하고,\n\"경민이의 남자 친구\" 처럼 숨겨져 있기도 합니다.\n\n※ 이번 ? 키워드는 위 지문에 적혀 있는 \"초대 링크\" 입니다.",
            "초대 링크": "[\"초대 링크\" 획득]\n- 아이템 코드 : 215 -\n\n\"ㄷㅁㄱㄱ\"\n\"13 1st Band, us\"\n\n(고민하기)\n\n※ [ ] 괄호는 아이템 획득을 뜻합니다.\n아이템 코드 \"215\"를 인벤토리에 입력하여 추가하세요.\n\n※ 초대 링크를 확인했다면,\n다음 키워드로 \"고민하기\"를 입력하세요!",
            "신유 도훈": "쉿 키스 중\n\n(Ctrl+Z)",
            "도훈 신유": "신랑 대기실에 오는 거 아니야\n\n(Ctrl+Z)",
            "고민하기": "초대 링크는 다 읽었고.. 이제 뭘 해야 할까?\n\n(? / 부장님 머리 둘레 측정)\n\n※ ? 키워드는 지문에 숨겨져 있기도 하지만,\n상황에 따라 문제의 정답일 때도 있습니다.\n밴드의 초대 코드나, 지금 같은 상황일 때 말이죠.\n\n또한, ? 키워드는 \"뛰^어쑤기를 포함\" 하기도 합니다.\n\n※ 첫 번째 문제이니, 간단한 가이드를 드릴게요.\n인벤토리 내 상세 설명에 초대 링크의 아이템 코드를 입력하여\n내용을 참고해 보세요.\n\n※ () 안의 힌트의 정답은 진행이 어려운\n놀짱을 위한 키워드 코드입니다.\n\n지금 막힌다면, 키워드 코드에 \"둘레1000\"을 입력하세요.",
            "둘레1000": "\"초대 링크\"의 주소를 입력해보세요.\n\n(Ctrl+Z)",
            "13 1st Band, us": "초대 링크에 나온 밴드로 찾아가 보았다.\n알싸하게 기분이 나쁜 방시혁의 건물이었다.\n\n(정문 / 창문 / 시혁의 과즙)\n\n※ 다음 단계는 아직 개발 중입니다!\n여기까지가 현재 플레이 가능한 구간이에요.",
            "정문": "정문은 자물쇠로 잠겨있다.\n\n(? / 입구)\n\n※ ? 키워드는 지문에 숨겨져 있다는 것을 명심하세요.\n그렇다면 이번 ? 키워드는 뭘까요?",
            "입구": "하이브 사옥 앞이다.\n번개가 내리치고 있다. 시혁의 미래가 어둡다.\n\n(정문 / 창문)",
            "자물쇠": "4자리의 숫자 자물쇠이다.\n\n(? / 입구 / 힌트2)\n\n※ ? 키워드는 문제의 정답일때도 있다는 것을 명심하세요.\n자물쇠의 비밀번호나, 도어락의 비밀번호같이 말이죠.",
            "힌트2": "\"초대 링크\"의 \"ㄷㅁㄱㄱ\"와\n창문의 \"낙서\"를 위아래로 조합하면\n4자리의 숫자를 알아낼 수 있습니다.\n\n(Ctrl+Z / 정답2)",
            "정답2": "초대 링크의 ㄷㅁㄱㄱ와\n낙서의 ┘ㅁㄷㅣ를 위아래로 합치면 숫자가 나옵니다.\n\n정답은 5827\n\n(자물쇠)",
            "5827": "자물쇠를 풀고 들어간 하이브의 내부는\n어둠이 짙게 깔려 있다. 바텀인 것 같다.\n언뜻 둘러봤을 때, 지하실, 거실, 부엌, 안방,\n2층으로 가는 길이 보였다.\n\n(? / 불 켜 예쁜아)",
            "불 켜 예쁜아": "지금 불이 켜지지 않는다.\n집 내부에 전기가 통하지 않는 것 같다.\n\n(Ctrl+Z)",
            "지하실": "왠지 으스스한 곳이다.\n분전함이 보인다.\n\n(? / 현관)",
            "현관": "자물쇠를 풀고 들어간 하이브의 내부는\n어둠이 짙게 깔려 있다. 바텀인 것 같다.\n언뜻 둘러봤을 때, 지하실, 거실, 부엌, 안방,\n2층으로 가는 길이 보였다.\n\n(? / 불 켜 예쁜아)",
            "거실": "어두워서 보이지 않는다.\n\n(Ctrl+Z)",
            "부엌": "어두워서 보이지 않는다.\n\n(Ctrl+Z)",
            "안방": "어두워서 보이지 않지만,\n이 문은 도어락으로 굳게 잠겨있다.\n\n(? / 현관)",
            "2층": "어두운 복도가 나왔다.\n서재와 작은방이 보인다.\n\n(? / 현관)",
            "창문": "하이브의 내부는 어두워서 보이지 않고,\n많은 비가 쏟아져 정신이 없다.\n창문 틀 밑으로 작은 낙서가 보인다.\n\n(? / 입구)\n\n※ ? 키워드는 지문에 숨겨져 있다는 것을 명심하세요.\n그렇다면 이번 ? 키워드는 뭘까요?",
            "낙서": "\"┘ㅁㄷㅣ\"\n\n(Ctrl+Z)",
            "시혁의 과즙": "그는 헤테로입니다\n\n(Ctrl+Z)"
        };
        
        const items = {
            '215': {
                name: '초대 링크',
                desc: '"ㄷㅁㄱㄱ"\n"13 1st Band, us"'
            }
        };
        
        const branches = {
            '7763': '분전함을 고쳤다.'
        };
        
        const input = document.getElementById('keywordInput');
        const successMsg = document.getElementById('successMsg');
        const errorMsg = document.getElementById('errorMsg');
        let gameStarted = false;
        let history = []; // 히스토리 스택
        
        // 인벤토리 시스템
        for (let i = 1; i <= 5; i++) {
            const itemInput = document.getElementById(`item${i}`);
            const itemName = document.getElementById(`itemName${i}`);
            
            itemInput.addEventListener('input', function() {
                const code = this.value.trim();
                if (items[code]) {
                    itemName.textContent = items[code].name;
                    itemName.style.color = '#4CAF50';
                } else if (code === '') {
                    itemName.textContent = '-';
                    itemName.style.color = '#fff';
                } else {
                    itemName.textContent = '?';
                    itemName.style.color = '#ff6b6b';
                }
            });
        }
        
        // 아이템 상세 설명
        const itemDetailCode = document.getElementById('itemDetailCode');
        const itemDetail = document.getElementById('itemDetail');
        
        itemDetailCode.addEventListener('input', function() {
            const code = this.value.trim();
            if (items[code]) {
                itemDetail.textContent = items[code].desc;
                itemDetail.style.color = '#4CAF50';
            } else if (code === '') {
                itemDetail.textContent = '아이템 코드를 입력하면 상세 설명이 표시됩니다.';
                itemDetail.style.color = '#ccc';
            } else {
                itemDetail.textContent = '올바르지 않은 아이템 코드입니다.';
                itemDetail.style.color = '#ff6b6b';
            }
        });
        
        // 분기점 시스템
        const branchInput = document.getElementById('branchCode');
        const branchDesc = document.getElementById('branchDesc');
        
        branchInput.addEventListener('input', function() {
            const code = this.value.trim();
            if (branches[code]) {
                branchDesc.textContent = branches[code];
                branchDesc.style.color = '#4CAF50';
            } else if (code === '') {
                branchDesc.textContent = '분기점 사용법: 하늘색 칸에 분기 코드를 기입하세요. 다른 칸은 건들지 마세요.';
                branchDesc.style.color = '#ccc';
            } else {
                branchDesc.textContent = '올바르지 않은 분기 코드입니다.';
                branchDesc.style.color = '#ff6b6b';
            }
        });
        
        // Ctrl+Z 감지
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'z' && gameStarted && history.length > 1) {
                e.preventDefault();
                history.pop(); // 현재 화면 제거
                const previous = history[history.length - 1];
                updateScreen(previous, false); // 히스토리에 추가하지 않음
                showSuccess('✓ 이전 화면으로 돌아갑니다.');
            }
        });
        
        // 메인 게임 로직
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const value = input.value.trim();
                handleKeyword(value);
                input.value = '';
            }
        });
        
        function handleKeyword(keyword) {
            if (!gameStarted && keyword !== '놀짱밴') {
                showError('✗ 잘못된 키워드입니다. "놀짱밴"을 입력하세요.');
                return;
            }
            
            if (keyword === '놀짱밴' && !gameStarted) {
                gameStarted = true;
                showSuccess('✓ 게임이 시작됩니다...');
                setTimeout(() => {
                    updateScreen(gameData['놀짱밴']);
                }, 1500);
                return;
            }
            
            // Ctrl+Z를 키워드로 입력한 경우
            if (keyword.toLowerCase() === 'ctrl+z' || keyword === 'ㅊ') {
                if (history.length > 1) {
                    history.pop();
                    const previous = history[history.length - 1];
                    updateScreen(previous, false);
                    showSuccess('✓ 이전 화면으로 돌아갑니다.');
                } else {
                    showError('✗ 돌아갈 화면이 없습니다.');
                }
                return;
            }
            
            const normalizedKeyword = keyword.toLowerCase();
            const found = Object.keys(gameData).find(k => k.toLowerCase() === normalizedKeyword);
            
            if (found) {
                updateScreen(gameData[found]);
            } else {
                showError(`✗ "${keyword}"는(은) 유효하지 않은 키워드입니다.`);
            }
        }
        
        function updateScreen(content, addToHistory = true) {
            const screen = document.querySelector('.screen');
            const formatted = content.replace(/\n/g, '<br>');
            screen.innerHTML = `<div class="intro-text" style="text-align: left; white-space: pre-line;">${formatted}</div>`;
            
            if (addToHistory) {
                history.push(content);
            }
        }
        
        function showSuccess(message) {
            errorMsg.style.display = 'none';
            successMsg.textContent = message;
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
        }
        
        function showError(message) {
            successMsg.style.display = 'none';
            errorMsg.textContent = message;
            errorMsg.style.display = 'block';
            setTimeout(() => {
                errorMsg.style.display = 'none';
            }, 2500);
        }
        
        input.focus();
    </script>
</body>
</html>
